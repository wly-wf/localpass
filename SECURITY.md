# LocalPass 安全说明

## 加密参数

### 密钥派生 (KDF)
使用 WebCrypto 原生的 PBKDF2 算法：
- **Hash**: SHA-256
- **Iterations**: 300,000 (可配置)
- **Salt**: 16 字节随机生成

```typescript
crypto.subtle.deriveKey(
  {
    name: 'PBKDF2',
    salt: salt,
    iterations: 300000,
    hash: 'SHA-256'
  },
  importedKey,
  { name: 'AES-GCM', length: 256 },
  false,
  ['encrypt', 'decrypt']
)
```

### 数据加密 (AEAD)
使用 AES-256-GCM：
- **IV**: 12 字节随机生成（每次加密不同）
- **Auth Tag**: 16 字节（GCM 模式自动生成）

### 为什么选择这些参数

1. **PBKDF2 vs Argon2id**
   - WebCrypto 原生支持 PBKDF2，性能稳定
   - Argon2 需要额外库 (@noble/hashes)
   - 300,000 次迭代在现代设备上约需 100-200ms
   - 如果需要更强的抗 GPU/ASIC 攻击，可切换到 Argon2id

2. **AES-256-GCM**
   - NIST 推荐的对称加密算法
   - GCM 模式提供认证加密，防止篡改
   - 256 位密钥提供足够的安全边际

## 自动锁定策略

- **默认**: 5 分钟无操作自动锁定
- **可配置**: 1/5/15/30 分钟或永不
- **触发事件**: 点击、键盘输入、滚动、触摸

## 剪贴板安全

- **默认**: 复制后 30 秒自动清空剪贴板
- **可配置**: 10/30/60 秒或永不
- **清空方式**: 写入空字符串

## 存储安全

### IndexedDB 存储内容
- 所有密码条目以加密形式存储
- 密文结构: `{ version, salt, iv, ciphertext, authTag }`
- 每个条目独立加密，使用相同主密码派生密钥

### 存储位置
- 浏览器 IndexedDB: `localpass-db`
- 设置项: `vault` store

## 导出安全

### 导出格式风险

| 格式 | 风险等级 | 说明 |
|------|----------|------|
| JSON | 高 | 包含完整明文密码，可直接导入 |
| TXT | 高 | 人类可读，包含明文密码 |
| PDF | 高 | 包含明文密码，可打印 |

### 导出保护措施
- 导出前必须先解锁
- 导出文件包含警告提示
- 文件名包含日期，便于追踪

### 安全建议
1. 导出文件存储在安全位置
2. 导出后尽快销毁临时文件
3. 定期备份，但保管好备份文件

## 威胁模型

### 保护场景 ✅
- 本地存储数据泄露（攻击者获得设备访问权）
- IndexedDB 数据被窃取
- 剪贴板数据被读取（自动清空）
- 网络窃听（所有数据本地存储）

### 无法防护场景 ❌
- 设备被恶意软件完全控制（键盘记录、内存读取）
- 暴力破解弱主密码
- 社会工程学（用户主动泄露主密码）
- 物理设备丢失（依赖主密码强度）

## 安全最佳实践

### 主密码建议
1. **长度**: 至少 16 位
2. **复杂度**: 使用大小写字母、数字、特殊字符
3. **唯一性**: 不在其他网站使用相同密码
4. **可记性**: 使用密码管理器或安全笔记保存

### 使用习惯
1. 设置合理的自动锁定时间
2. 启用剪贴板自动清空
3. 定期检查设备安全
4. 不在公共设备使用

## 已知限制

1. **纯前端限制**
   - 无法防止 XSS 攻击（所有数据在内存中解密）
   - 无法防止恶意浏览器扩展
   - 依赖浏览器 WebCrypto 实现

2. **PWA 限制**
   - Service Worker 可被禁用
   - 缓存可能被清除

3. **设备限制**
   - 无法防止物理设备攻击
   - 无法防止恶意软件

## 审计建议

建议在生产使用前进行：
1. 代码安全审计
2. 渗透测试
3. 加密实现验证

## 版本历史

| 版本 | 日期 | 变更 |
|------|------|------|
| 1.0.0 | 2024-01 | 初始版本 |
